{{ define "main" }}
  <div class='hx:mx-auto hx:flex hextra-max-page-width'>
    {{ partial "sidebar.html" (dict "context" .) }}
    {{ partial "custom-toc.html" . }}
    <article class="hx:w-full hx:break-words hx:flex hx:min-h-[calc(100vh-var(--navbar-height))] hx:min-w-0 hx:justify-center hx:pb-8 hx:pr-[calc(env(safe-area-inset-right)-1.5rem)]">
      <main class="hx:w-full hx:min-w-0 hx:max-w-6xl hx:px-6 hx:pt-4 hx:md:px-12">
        {{ partial "breadcrumb.html" . }}
        <div class="content">
          {{ if .Title }}<h1>{{ .Title }}</h1>{{ end }}
          {{ .Content }}
          
          {{ $datasets := .Site.Data.datasets }}
          {{ $targets := slice }}
          
          {{/* Collect all unique targets */}}
          {{ range $datasets }}
            {{ $target := .target }}
            {{ $found := false }}
            {{ range $targets }}
              {{ if eq . $target }}
                {{ $found = true }}
              {{ end }}
            {{ end }}
            {{ if not $found }}
              {{ $targets = $targets | append $target }}
            {{ end }}
          {{ end }}
          
          {{/* Sort targets alphabetically */}}
          {{ $targets = sort $targets }}
          
          {{/* Display datasets grouped by target */}}
          {{ range $targets }}
            {{ $target := . }}
            <h2 id="{{ $target }}">{{ $target | title }} Datasets</h2>
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>ID</th>
                  <th>CARTO URL</th>
                </tr>
              </thead>
              <tbody>
                {{ range where $datasets "target" $target }}
                  <tr>
                    <td>{{ .name }}</td>
                    <td>{{ .id }}</td>
                    <td><a href="{{ .carto_url }}" target="_blank">{{ .carto_url }}</a></td>
                  </tr>
                {{ end }}
              </tbody>
            </table>
          {{ end }}
        </div>
        {{ partial "components/last-updated.html" . }}
        {{ partial "components/pager.html" . }}
        {{ partial "components/comments.html" . }}
      </main>
    </article>
  </div>
          {{ partial "custom-toc-script.html" . }}
{{ end }}