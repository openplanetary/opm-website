{{ define "main" }}
  <div class='hx:mx-auto hx:flex hextra-max-page-width'>
{{ partial "sidebar.html" (dict "context" .) }}
    <article class="hx:w-full hx:break-words hx:flex hx:min-h-[calc(100vh-var(--navbar-height))] hx:min-w-0 hx:justify-center hx:pb-8 hx:pr-[calc(env(safe-area-inset-right)-1.5rem)]">
      <main class="hx:w-full hx:min-w-0 hx:max-w-6xl hx:px-6 hx:pt-4 hx:md:px-12">
        {{ partial "breadcrumb.html" . }}
        <div class="content">
          <h1 id="basemaps">Basemaps</h1>
          <p>Click on a basemap card to view more details.</p>

          {{/* Build cards from data/basemaps.json using hextra card partials */}}
          {{- $basemaps := site.Data.basemaps -}}
          {{- if gt (len $basemaps) 0 -}}
            {{- /* Determine target from current page/section front matter (optional) */ -}}
            {{- $targetParam := .Params.target | default "" -}}
            {{- $targetParam = lower $targetParam -}}
            {{- $targetParam = urlize $targetParam -}}
            {{- $cards := slice -}}
            {{- range $b := $basemaps -}}
              {{- /* Normalize the basemap's target for filtering and links */ -}}
              {{- $dataTarget := index $b "Target" | lower | urlize -}}
              {{- $itemTarget := replaceRE "^the-" "" $dataTarget -}}

              {{- /* Apply filtering only when a target is specified in front matter */ -}}
              {{- $matches := or (eq $targetParam "") (eq $itemTarget $targetParam) -}}
              {{- if $matches -}}
                {{- $tag := "" -}}
                {{- /* Preliminary can be boolean true or non-empty string */ -}}
                {{- if $b.Preliminary }}{{- $tag = "Preliminary" -}}{{- end -}}
                {{- $image := index $b "Static Map Image" -}}

                {{- /* Build link to basemap page including target in the path when available */ -}}
                {{- $targetSlug := cond (ne $targetParam "") $targetParam $itemTarget -}}
                {{- $link := cond (ne $targetSlug "") (printf "/basemaps/%s/%s/" $targetSlug $b.mapID) (printf "/basemaps/%s/" $b.mapID) -}}
                {{- $link = $link | relURL -}}

                {{- $card := partial "shortcodes/card.html" (dict
                      "link" $link
                      "title" $b.Name
                      "subtitle" $b.Description
                      "image" $image
                      "imageStyle" "object-fit:cover; aspect-ratio:16/9;"
                      "tag" $tag
                      "tagType" "warning"
                  ) -}}
                {{- $cards = $cards | append $card -}}
              {{- end -}}
            {{- end -}}

            {{- if gt (len $cards) 0 -}}
              {{- partial "shortcodes/cards.html" (dict "cols" 3 "content" (delimit $cards "\n")) -}}
            {{- else -}}
              {{- if ne $targetParam "" -}}
                <p>No basemaps found for target "{{ $targetParam }}".</p>
              {{- else -}}
                <p>No basemaps found.</p>
              {{- end -}}
            {{- end -}}
          {{- else -}}
            <p>No basemaps found.</p>
          {{- end -}}
        </div>
      </main>
    </article>
  </div>

{{ end }}
