<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize scroll behavior for custom TOC links
    const tocLinks = document.querySelectorAll('.hextra-toc a');
    
    tocLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        
        const targetId = this.getAttribute('href').substring(1);
        const targetElement = document.getElementById(targetId);
        
        if (targetElement) {
          // Smooth scroll to target
          window.scrollTo({
            top: targetElement.offsetTop - 100, // Offset to account for fixed header
            behavior: 'smooth'
          });
          
          // Update URL hash without scrolling
          history.pushState(null, null, '#' + targetId);
        }
      });
    });
    
    // Highlight active TOC item based on scroll position
    function updateActiveTocItem() {
      const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
      const scrollPosition = window.scrollY;
      
      // Find the current heading in view
      let currentHeading = null;
      
      headings.forEach(heading => {
        if (heading.offsetTop - 150 <= scrollPosition) {
          currentHeading = heading;
        }
      });
      
      // Remove active class from all TOC links
      tocLinks.forEach(link => {
        link.classList.remove('hx:text-primary');
      });
      
      // Add active class to current TOC link
      if (currentHeading && currentHeading.id) {
        const activeLink = document.querySelector(`.hextra-toc a[href="#${currentHeading.id}"]`);
        if (activeLink) {
          activeLink.classList.add('hx:text-primary');
        }
      }
    }
    
    // Update active TOC item on scroll
    window.addEventListener('scroll', updateActiveTocItem);
    
    // Initial update
    updateActiveTocItem();
  });
</script>
